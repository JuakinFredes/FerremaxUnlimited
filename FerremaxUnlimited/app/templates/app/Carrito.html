{% extends 'app/base.html' %}
{% load static %}

<!--este bloque es para los css especificos de pagina-->
{% block css %}
<link rel="stylesheet" href="{% static 'css/carrito.css' %}">
{% endblock %}

<!--este bloque es para los javascript especificos de pagina-->
{% block js %}
<script>
    const unitPrices = {
      qty1: 10,
      qty2: 15
    };
  
    function changeQty(id, delta) {
      const input = document.getElementById(id);
      let val = parseInt(input.value) || 1;
      val += delta;
      if (val < parseInt(input.min)) val = parseInt(input.min);
      if (val > parseInt(input.max)) val = parseInt(input.max);
      input.value = val;
      updateTotal();
    }
  
    function updateTotal() {
      let total = 0;
  
      Object.keys(unitPrices).forEach(id => {
        const qty = parseInt(document.getElementById(id).value) || 1;
        const price = unitPrices[id];
        const lineTotal = qty * price;
        document.getElementById('total' + id.replace('qty', '')).textContent = `$${lineTotal.toFixed(2)}`;
        total += lineTotal;
      });
  
      document.getElementById('grandTotal').textContent = total.toFixed(2);
    }
  

  </script>

{% endblock %}



{% block contenido %}

<div class="container py-5">
    <h2 class="mb-4">Tu Carrito</h2>

    {% if carrito %}
        {% for item in carrito %}
        <div class="row align-items-center cart-item shadow mb-4 rounded">
            <div class="col-md-2">
                <img src="{{ item.productos.imagen.url }}" alt="{{ item.productos.nombre }}" class="img-fluid">
            </div>
            <div class="col-md-2">
                <h5>{{ item.productos.nombre }}</h5>
                <p class="mb-0 text-muted">Precio unitario: ${{ item.productos.precio }}</p>
            </div>
            <div class="col-md-2">
                <div class="input-group" style="max-width: 120px;">
                    <button class="btn btn-outline-secondary" type="button" onclick="changeQty('qty{{ forloop.counter }}', -1)">âˆ’</button>
                    <input type="number" class="form-control text-center"
                           id="qty{{ forloop.counter }}"
                           value="{{ item.cantidad }}" min="1" max="99"
                           onchange="updateTotal()">
                    <button class="btn btn-outline-secondary" type="button" onclick="changeQty('qty{{ forloop.counter }}', 1)">+</button>
                </div>
            </div>
            <div class="col-md-2">
                <p class="fw-bold mb-0" id="total{{ forloop.counter }}">${{ item.productos.precio|floatformat:2 }}</p>
            </div>
            <div class="col-md-2">
                <form action="{% url 'eliminarCarro' item.productos.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger">Eliminar</button>
                </form>
            </div>
        </div>
        {% endfor %}

        <!-- Total final -->
        <div class="row justify-content-end mt-4">
            <div class="col-md-4 text-end">
                <h4>Total: $<span id="grandTotal">{{ total }}</span></h4>
                <button class="btn btn-success">Finalizar Compra</button>
            </div>
        </div>
    {% else %}
        <p>No tienes productos en tu carrito.</p>
    {% endif %}
</div>


{% endblock %}